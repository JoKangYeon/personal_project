<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.study.market_board.dao.IMbDao">


    <insert id="insertMb" parameterType="com.study.market_board.vo.MbVO">
        <selectKey keyProperty="mbNo" resultType="int" order="BEFORE">
            SELECT seq_market_board.nextval from dual
        </selectKey>
        INSERT INTO market_board (
        mb_no,
        mb_product,
        mb_title,
        mb_category,
        mb_price,
        mb_writer,
        mb_content
        ) VALUES (
        #{mbNo},
        #{mbProduct},
        #{mbTitle},
        #{mbCategory},
        #{mbPrice},
        #{mbWriter},
        #{mbContent}
        )
    </insert>


    <select id="getMbList" resultType="com.study.market_board.vo.MbVO" >
        SELECT b.*
        FROM   (SELECT
        rownum AS rnum,
        a.*
        FROM   (SELECT
        mb_no,
        mb_product,
        mb_title,
        mb_category,
        mb_price,
        mb_writer,
        mb_content,
        mb_hit,
        mb_reg_date,
        mb_mod_date,
        mb_del_yn
        FROM
        market_board
        WHERE mb_del_yn = 'N'

        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(cate)">
          <if test='cate != "MBC01"'>
                AND mb_category = #{cate}
              <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchWord)">
                  AND mb_title LIKE '%' || #{searchWord} ||'%'
              </if>
          </if>
            <if test='cate == "MBC01"'>
                <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchWord)">
                    AND mb_product LIKE '%' || #{searchWord} ||'%'
                </if>
            </if>
        </if>

        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(sort)">
            <if test='sort == "ASC"'>ORDER BY mb_no ASC</if>
            <if test='sort == "DESC"'>ORDER BY mb_no DESC</if>
        </if>
        ) a ) b
        WHERE rnum between #{paging.firstRow} and #{paging.lastRow}

    </select>


    <select id="getTotalRowCount" resultType="java.lang.Integer">
        SELECT count(*)
        FROM market_board
        WHERE mb_del_yn='N'
        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(cate)">

            <if test='cate != "MBC01"'>
                AND mb_category = #{cate}
            </if>
        </if>
        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchWord)">
                AND mb_product LIKE '%' || #{searchWord} ||'%'
        </if>

    </select>

    <select id="getMbBoard" resultType="com.study.market_board.vo.MbVO" parameterType="integer">
        SELECT
            mb_no,
            mb_product,
            mb_title,
            mb_category,
            mb_price,
            mb_writer,
            mb_content,
            mb_hit,
            mb_reg_date,
            mb_mod_date,
            mb_del_yn
        FROM
            market_board
        WHERE mb_no = #{mbNo}
    </select>

    <insert id="addViewCount" parameterType="int">
        UPDATE market_board
        SET
            mb_hit = mb_hit + 1
        WHERE
            mb_no = #{mbNo}
    </insert>


</mapper>